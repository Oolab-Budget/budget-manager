<!DOCTYPE html>
<html>
<head>
    <title>Check Saved Budgets</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .info { background: #e8f4fd; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Check Saved Budgets in localStorage</h1>
    
    <div id="results"></div>
    
    <button onclick="checkBudgets()">Check Saved Budgets</button>
    <button onclick="exportBudgets()">Export to JSON</button>
    <button onclick="clearResults()">Clear Results</button>
    
    <script>
        function checkBudgets() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            try {
                const savedBudgets = JSON.parse(localStorage.getItem('savedBudgets') || '[]');
                
                if (savedBudgets.length === 0) {
                    resultsDiv.innerHTML = '<div class="error"><h3>No saved budgets found in localStorage</h3><p>The savedBudgets key exists but is empty or not found.</p></div>';
                } else {
                    resultsDiv.innerHTML = `
                        <div class="success">
                            <h3>Found ${savedBudgets.length} saved budget(s)</h3>
                            <p>All saved budgets are present in localStorage.</p>
                        </div>
                        <div class="info">
                            <h4>Budget Summary:</h4>
                            <ul>
                                ${savedBudgets.map((b, i) => `
                                    <li>
                                        <strong>Budget ${i + 1}:</strong> ${b.weekLabel || 'No label'} 
                                        - Saved: ${new Date(b.savedDate).toLocaleString()} 
                                        - Total: $${b.total?.toLocaleString('es-MX') || 0} MXN
                                        - Items: ${b.itemCount || 0}
                                        ${b.isPartialPayment ? ' <span style="color: #3498db;">[PARTIAL PAYMENT]</span>' : ''}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="info">
                            <h4>Full Data (first 2000 chars):</h4>
                            <pre>${JSON.stringify(savedBudgets, null, 2).substring(0, 2000)}${savedBudgets.length > 0 ? '...' : ''}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error"><h3>Error reading saved budgets</h3><p>${error.message}</p></div>`;
            }
        }
        
        function exportBudgets() {
            try {
                const savedBudgets = JSON.parse(localStorage.getItem('savedBudgets') || '[]');
                const dataStr = JSON.stringify(savedBudgets, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `saved-budgets-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                alert(`Exported ${savedBudgets.length} saved budget(s) to JSON file.`);
            } catch (error) {
                alert('Error exporting: ' + error.message);
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Auto-check on load
        window.onload = function() {
            checkBudgets();
        };
    </script>
</body>
</html>